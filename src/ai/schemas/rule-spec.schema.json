{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cogni.dao/schemas/rule-spec-mvp.schema.json",
  "title": "Cogni AI Rule Specification - MVP",
  "description": "Minimal schema for AI evaluation rules",
  "type": "object",
  "required": ["id", "schema_version", "workflow_id", "success_criteria"],
  "additionalProperties": false,
  "patternProperties": {
    "^x_": {
      "description": "Vendor-prefixed extension fields"
    }
  },
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 3,
      "maxLength": 50,
      "description": "Unique identifier for the rule"
    },
    "schema_version": {
      "type": "string",
      "enum": ["0.2"],
      "description": "Rule schema version"
    },
    "blocking": {
      "type": "boolean",
      "default": false,
      "description": "Whether rule failure blocks PR"
    },
    "workflow_id": {
      "type": "string",
      "description": "Workflow identifier for AI evaluation"
    },
    "evaluation-statement": {
      "type": "string",
      "minLength": 10,
      "description": "Statement describing what to evaluate in the PR"
    },
    "success_criteria": {
      "type": "object",
      "description": "Success criteria using require/any_of format",
      "additionalProperties": false,
      "properties": {
        "require": {
          "type": "array",
          "items": { "$ref": "#/$defs/Comparison" },
          "minItems": 1,
          "description": "All criteria must pass"
        },
        "any_of": {
          "type": "array", 
          "items": { "$ref": "#/$defs/Comparison" },
          "minItems": 1,
          "description": "At least one criterion must pass"
        },
        "neutral_on_missing_metrics": {
          "type": "boolean",
          "description": "Return neutral when required metrics are missing"
        }
      },
      "anyOf": [
        { 
          "required": ["require"], 
          "properties": { 
            "require": { "type": "array", "minItems": 1 } 
          } 
        },
        { 
          "required": ["any_of"], 
          "properties": { 
            "any_of": { "type": "array", "minItems": 1 } 
          } 
        }
      ]
    },
    "selectors": {
      "type": "object",
      "description": "File selectors (present but ignored in MVP)",
      "additionalProperties": false,
      "properties": {
        "paths": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Glob patterns (ignored in MVP)"
        },
        "diff_kinds": {
          "type": "array", 
          "items": {"type": "string"},
          "description": "Change types (ignored in MVP)"
        }
      }
    }
  },
  "$defs": {
    "Comparison": {
      "type": "object",
      "additionalProperties": false,
      "required": ["metric"],
      "properties": {
        "metric": {
          "type": "string",
          "minLength": 1,
          "description": "Metric name to compare"
        },
        "gte": { "type": "number", "description": "Greater than or equal" },
        "gt": { "type": "number", "description": "Greater than" },
        "lte": { "type": "number", "description": "Less than or equal" },
        "lt": { "type": "number", "description": "Less than" },
        "eq": { "type": "number", "description": "Equal to" }
      },
      "oneOf": [
        { "required": ["gte"], "properties": { "gte": { "type": "number" } } },
        { "required": ["gt"], "properties": { "gt": { "type": "number" } } },
        { "required": ["lte"], "properties": { "lte": { "type": "number" } } },
        { "required": ["lt"], "properties": { "lt": { "type": "number" } } },
        { "required": ["eq"], "properties": { "eq": { "type": "number" } } }
      ]
    }
  }
}